<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Χ™Χ•ΧΧ ΧΧ΅Χ—Χ¨</title>

  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#9E7E67" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Χ™Χ•ΧΧ ΧΧ΅Χ—Χ¨" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="msapplication-TileColor" content="#9E7E67" />
  <meta name="msapplication-config" content="/browserconfig.xml" />

  <!-- PWA Links -->
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' rx='64' fill='%239E7E67'/><text x='256' y='280' font-family='Arial, sans-serif' font-size='200' font-weight='bold' text-anchor='middle' fill='%23EAEAE7'>π“</text></svg>" />

  <link rel="stylesheet" href="styles.css" />
  <script>
    // If served via Apps Script, Code.gs can inject window.WEB_APP_URL; otherwise leave empty
    window.WEB_APP_URL = window.WEB_APP_URL || '';

    // Register Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => {
            console.log('SW registered: ', registration);
          })
          .catch(registrationError => {
            console.log('SW registration failed: ', registrationError);
          });
      });
    }
  </script>
</head>
<body>
  <header class="topbar">
    <div class="header-content">
      <h1 class="app-title">Χ™Χ•ΧΧ ΧΧ΅Χ—Χ¨</h1>
      <nav class="nav">
        <a href="#dashboard" class="nav-link">ΧΧ•Χ— ΧΧ—Χ•Χ•Χ Χ™Χ</a>
        <a href="#new" class="nav-link">ΧΆΧ΅Χ§Χ” Χ—Χ“Χ©Χ”</a>
        <a href="#trades" class="nav-link">Χ¨Χ©Χ™ΧΧ ΧΆΧ΅Χ§ΧΧ•Χ</a>
        <a href="#settings" class="nav-link">Χ”Χ’Χ“Χ¨Χ•Χ</a>
      </nav>
    </div>
  </header>

  <main id="app">
    <section id="view-dashboard" class="view hidden"></section>
    <section id="view-new" class="view hidden"></section>
    <section id="view-trades" class="view hidden"></section>
    <section id="view-settings" class="view hidden"></section>
  </main>

  <template id="tpl-dashboard">
    <div class="cards">
      <div class="card"><div class="label">Χ™ΧΧ¨Χ” Χ Χ•Χ›Χ—Χ™Χ</div><div class="value" id="cur-balance">β€”</div></div>
      <div class="card"><div class="label">Χ™ΧΆΧ“ Χ™Χ•ΧΧ™</div><div class="value" id="daily-target">β€”</div></div>
      <div class="card"><div class="label">Χ”Χ¤Χ΅Χ“ Χ™Χ•ΧΧ™ ΧΧ§Χ΅Χ³</div><div class="value" id="daily-max-loss">β€”</div></div>
    </div>
    <div class="progress">
      <div class="progress-label">Χ”ΧΧ§Χ“ΧΧ•Χ ΧΧ™ΧΆΧ“ Χ”Χ™Χ•Χ</div>
      <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>
      <div class="progress-stats"><span id="today-pnl">0</span> / <span id="today-target">0</span></div>
    </div>
    <div class="stats-grid">
      <div class="stat"><div class="label">Χ”Χ™Χ Χ¨Χ™Χ™Χ Χ™Χ•ΧΧ™</div><div class="value" id="hit-rate-day">β€”</div></div>
      <div class="stat"><div class="label">Χ”Χ™Χ Χ¨Χ™Χ™Χ Χ©Χ‘Χ•ΧΆΧ™</div><div class="value" id="hit-rate-week">β€”</div></div>
      <div class="stat"><div class="label">R:R ΧΧΧ•Χ¦ΧΆ</div><div class="value" id="avg-rr">β€”</div></div>
      <div class="stat"><div class="label">Χ΅Χ”Χ΄Χ› Χ¨Χ•Χ•Χ—/Χ”Χ¤Χ΅Χ“ Χ™Χ•ΧΧ™</div><div class="value" id="sum-day">β€”</div></div>
      <div class="stat"><div class="label">Χ΅Χ”Χ΄Χ› Χ¨Χ•Χ•Χ—/Χ”Χ¤Χ΅Χ“ Χ©Χ‘Χ•ΧΆΧ™</div><div class="value" id="sum-week">β€”</div></div>
    </div>
  </template>

  <template id="tpl-new">
    <form id="new-trade-form" class="form">
      <div class="form-grid">
        <label>ΧΧΧ¨Χ™Χ<input type="date" name="date" required></label>
        <label>Χ©ΧΆΧ”<input type="time" name="time" required></label>
        <label>Χ΅Χ™ΧΧ‘Χ•Χ<select name="symbol" id="symbol-select"></select></label>
        <label>Χ›Χ™Χ•Χ•Χ<select name="direction" required>
          <option value="Long">Long</option>
          <option value="Short">Short</option>
        </select></label>
        <label>Entry<input type="number" step="0.01" name="entry" id="entry"></label>
        <label>Stop<input type="number" step="0.01" name="stop" id="stop"></label>
        <label title="TP Χ™Χ—Χ•Χ©Χ‘ Χ΅Χ™ΧΧΧ¨Χ™Χ Χ-Entry/Stop ΧΧ ΧΧ΅Χ•ΧΧ">
          Take Profit
          <input type="number" step="0.01" name="take_profit" id="take_profit">
        </label>
        <label>Χ›ΧΧ•Χ<input type="number" step="1" name="qty" id="qty"></label>
        <label>ΧΆΧΧΧ•Χ<input type="number" step="0.01" name="commission" id="commission" value="0"></label>
        <label>ΧΆΧΧΧ•Χ Χ Χ•Χ΅Χ¤Χ•Χ<input type="number" step="0.01" name="fees" id="fees" value="0"></label>
        <label>Χ”ΧΆΧ¨Χ•Χ<textarea name="notes"></textarea></label>
      </div>
      <div class="side-info">
        <div>Χ™ΧΧ¨Χ”: <span id="si-balance">β€”</span></div>
        <div>TP%: <span id="si-tp">β€”</span> | SL%: <span id="si-sl">β€”</span></div>
        <div>Χ΅Χ™Χ›Χ•Χ (β‚): <span id="si-risk">β€”</span></div>
        <div>Χ™ΧΆΧ“ (β‚): <span id="si-tp-amount">β€”</span> | Χ΅ΧΧ•Χ¤ (β‚): <span id="si-sl-amount">β€”</span></div>
        <div>R:R: <span id="si-rr">β€”</span></div>
        <label class="inline"><input type="checkbox" id="auto-tp" checked> Χ—Χ©Χ‘ TP Χ΅Χ™ΧΧΧ¨Χ™</label>
      </div>
      <div class="actions">
        <button type="submit" data-status="Planned">Χ©ΧΧ•Χ¨ Χ›β€‘Planned</button>
        <button type="submit" data-status="Executed" class="secondary">Χ΅ΧΧ Χ›β€‘Executed</button>
      </div>
    </form>
  </template>

  <template id="tpl-trades">
    <div class="filters">
      <input type="date" id="flt-start" />
      <input type="date" id="flt-end" />
      <select id="flt-symbol"></select>
      <select id="flt-status" multiple>
        <option>Planned</option>
        <option>Executed</option>
        <option>TP</option>
        <option>SL</option>
        <option>BE</option>
        <option>Partial</option>
        <option>Cancelled</option>
      </select>
      <button id="apply-filter">Χ΅Χ Χ</button>
    </div>
    <table class="table">
      <thead>
        <tr>
          <th>ID</th><th>ΧΧΧ¨Χ™Χ</th><th>Χ©ΧΆΧ”</th><th>Χ΅Χ™ΧΧ‘Χ•Χ</th><th>Χ›Χ™Χ•Χ•Χ</th><th>Entry</th><th>Stop</th><th>TP</th><th>Qty</th><th>R:R</th><th>Χ΅ΧΧΧ•Χ΅</th><th>PNL</th><th>Χ¤ΧΆΧ•ΧΧ•Χ</th>
        </tr>
      </thead>
      <tbody id="trades-body"></tbody>
    </table>
  </template>

  <template id="tpl-settings">
    <form id="settings-form" class="form">
      <div class="form-grid">
        <label>Χ™ΧΧ¨Χ Χ¤ΧΧ™Χ—Χ”<input type="number" step="0.01" name="starting_balance" required></label>
        <label>Χ™ΧΆΧ“ Χ™Χ•ΧΧ™<input type="number" step="0.01" name="daily_target" required></label>
        <label>Χ”Χ¤Χ΅Χ“ Χ™Χ•ΧΧ™ ΧΧ§Χ΅Χ³<input type="number" step="0.01" name="daily_max_loss" required></label>
        <label>TP%<input type="number" step="0.01" name="tp_pct" required></label>
        <label>SL%<input type="number" step="0.01" name="sl_pct" required></label>
      </div>
      <h3>ΧΧ™Χ Χ΅ΧΧ¨Χ•ΧΧ ΧΧ™Χ</h3>
      <table class="table">
        <thead><tr><th>Χ΅Χ™ΧΧ‘Χ•Χ</th><th>Tick Size</th><th>Tick Value</th><th>Contract Size</th><th></th></tr></thead>
        <tbody id="inst-body"></tbody>
      </table>
      <button type="button" id="add-inst">Χ”Χ•Χ΅Χ£ ΧΧ™Χ Χ΅ΧΧ¨Χ•ΧΧ Χ</button>
      <div class="actions">
        <button type="submit">Χ©ΧΧ•Χ¨</button>
      </div>
    </form>
  </template>

  <div id="toast" class="toast hidden"></div>
  <script src="app.js"></script>
</body>
</html>
